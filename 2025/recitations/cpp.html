<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/2025/assets/css/just-the-docs-default.css"> <script src="/2025/assets/js/vendor/lunr.min.js"></script> <script src="/2025/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>CTF of C Programming | 6.5950/6.5951</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="CTF of C Programming" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Secure Hardware Design" /> <meta property="og:description" content="Secure Hardware Design" /> <meta property="og:site_name" content="6.5950/6.5951" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="CTF of C Programming" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Secure Hardware Design","headline":"CTF of C Programming","url":"/2025/recitations/cpp.html"}</script> <!-- End Jekyll SEO tag --> <!-- Cover up the page while CSS is loading to prevent flicker --> <div id="preload-cover"></div> <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" /> <style> #preload-cover { position:fixed; height:100%; width:100%; top:0; left:0; background:#fff; z-index:9999; } @media (prefers-color-scheme: dark) { #preload-cover { position:fixed; height:100%; width:100%; top:0; left:0; background:#222326; z-index:9999; } } </style> <script> window.addEventListener('load', function() { var cover = document.getElementById('preload-cover'); cover.style.display = 'none'; }); </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/2025/" class="site-title lh-tight"> 6.5950/6.5951 </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/2025/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/2025/calendar.html" class="nav-list-link">Calendar</a></li><li class="nav-list-item"><a href="/2025/lectureReadings.html" class="nav-list-link">Lecture Readings</a></li><li class="nav-list-item"><a href="/2025/paperDiscussion.html" class="nav-list-link">Paper Discussion</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Recitations category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/2025/recitations.html" class="nav-list-link">Recitations</a><ul class="nav-list "><li class="nav-list-item active"><a href="/2025/recitations/cpp.html" class="nav-list-link active">CTF of C Programming</a></li><li class="nav-list-item "><a href="/2025/recitations/cache.html" class="nav-list-link">Cache Recitation</a></li><li class="nav-list-item "><a href="/2025/recitations/physical.html" class="nav-list-link">CTF of Physical Attacks</a></li><li class="nav-list-item "><a href="/2025/recitations/riscv.html" class="nav-list-link">Binary Exploitation and RISC-V Warmup</a></li><li class="nav-list-item "><a href="/2025/recitations/formal.html" class="nav-list-link">Formal Verification</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Labs category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/2025/labs.html" class="nav-list-link">Labs</a><ul class="nav-list "><li class="nav-list-item "><a href="/2025/labs/ccc.html" class="nav-list-link">C Crash Course</a></li><li class="nav-list-item "><a href="/2025/labs/fingerprinting.html" class="nav-list-link">Website Fingerprinting</a></li><li class="nav-list-item "><a href="/2025/labs/cache.html" class="nav-list-link">Cache Attacks</a></li><li class="nav-list-item "><a href="/2025/labs/spectre.html" class="nav-list-link">Spectre Attacks</a></li><li class="nav-list-item "><a href="/2025/labs/rowhammer.html" class="nav-list-link">Rowhammer</a></li><li class="nav-list-item "><a href="/2025/labs/aslr.html" class="nav-list-link">ASLR Bypasses</a></li><li class="nav-list-item "><a href="/2025/labs/psp.html" class="nav-list-link">Pretty Secure Processor</a></li><li class="nav-list-item "><a href="/2025/labs/fuzz.html" class="nav-list-link">CPU Fuzzing</a></li><li class="nav-list-item "><a href="/2025/labs/formal.html" class="nav-list-link">CPU Verification</a></li></ul></li><li class="nav-list-item"><a href="/2025/paperReadingGuidance.html" class="nav-list-link">Paper Readings Guidance</a></li><li class="nav-list-item"><a href="/2025/forInstructors.html" class="nav-list-link">For Instructors</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search 6.5950/6.5951" aria-label="Search 6.5950/6.5951" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <span id="dark-light-switch" class="material-symbols-outlined"></span> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/2025/recitations.html">Recitations</a></li> <li class="breadcrumb-nav-list-item"><span>CTF of C Programming</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="ctf-of-c-programming"> <a href="#ctf-of-c-programming" class="anchor-heading" aria-labelledby="ctf-of-c-programming"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CTF of C Programming </h1> <p>Throughout the class, we’ll be heavily relying on the low-level C and C++ languages. Using C and C++ allows us to manipulate the hardware at a very fine granularity, allowing us to pull off very powerful microarchitectural attacks in later labs. This is in contrast with higher-level languages, such as python, which make reasoning about the exact instructions executed by a program difficult.</p> <p>In this recitation we’ll primarily focus on learning how to write code in C, since C++ is a superset of C’s syntax (with limited exceptions). x</p> <h2 class="no_toc" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents </h2> <ul id="markdown-toc"> <li><a href="#crash-course" id="markdown-toc-crash-course">Crash Course</a></li> <li><a href="#pointers" id="markdown-toc-pointers">Pointers</a> <ul> <li><a href="#declaration-address-of-dereference" id="markdown-toc-declaration-address-of-dereference">Declaration, Address-of, Dereference</a></li> <li><a href="#casting" id="markdown-toc-casting">Casting</a></li> <li><a href="#a-pointer-points-to-another-pointer" id="markdown-toc-a-pointer-points-to-another-pointer">A Pointer Points to Another Pointer</a></li> </ul> </li> <li><a href="#commonly-used-data-structures" id="markdown-toc-commonly-used-data-structures">Commonly Used Data Structures</a> <ul> <li><a href="#arrays" id="markdown-toc-arrays">Arrays</a></li> <li><a href="#strings" id="markdown-toc-strings">Strings</a></li> </ul> </li> <li><a href="#useful-for-the-cache-lab" id="markdown-toc-useful-for-the-cache-lab">Useful for the Cache Lab</a> <ul> <li><a href="#dynamically-allocated-memory" id="markdown-toc-dynamically-allocated-memory">Dynamically Allocated Memory</a></li> </ul> </li> <li><a href="#useful-for-rowhammer-lab" id="markdown-toc-useful-for-rowhammer-lab">Useful for Rowhammer Lab</a> <ul> <li><a href="#c-maps-stdmap" id="markdown-toc-c-maps-stdmap">C++ Maps (<code class="language-plaintext highlighter-rouge">std::map</code>)</a></li> </ul> </li> <li><a href="#capture-the-flag-ctf" id="markdown-toc-capture-the-flag-ctf">Capture the Flag (CTF)</a></li> </ul> <h2 id="crash-course"> <a href="#crash-course" class="anchor-heading" aria-labelledby="crash-course"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Crash Course </h2> <p>We’ll first walk through a quick code example to get you familiar with the format of C.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#define MAGIC_NUM 5
</span>
<span class="kt">void</span> <span class="nf">sayHello</span><span class="p">(</span><span class="kt">int</span> <span class="n">helloNum</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Hello World! The addition sum is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">helloNum</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">MAGIC_NUM</span><span class="p">;</span>
  <span class="n">sayHello</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>A few things to note about this code:</p> <ul> <li><code class="language-plaintext highlighter-rouge">#include</code> and <code class="language-plaintext highlighter-rouge">#define</code> are <em>pre-processor directives</em>, which are resolved prior to compilation. <ul> <li><code class="language-plaintext highlighter-rouge">#include</code> tells the pre-processor to include the contents of the <em>listed</em> file (e.g. <code class="language-plaintext highlighter-rouge">stdio.h</code>) when compiling <em>this</em> file.</li> <li><code class="language-plaintext highlighter-rouge">#define</code> tells the pre-processor to replace all instances of the listed term with the following value (e.g. <code class="language-plaintext highlighter-rouge">MAGIC_NUM</code> is replaced with <code class="language-plaintext highlighter-rouge">5</code> everywhere in the code prior to compilation)</li> </ul> </li> <li>C is a relatively strongly typed language, especially compared to Python, requiring variables to be explicitly declared with their type (e.g. <code class="language-plaintext highlighter-rouge">int</code>).</li> <li><code class="language-plaintext highlighter-rouge">printf</code> prints a message to console. You can include variables in your printout by including a <a href="https://cplusplus.com/reference/cstdio/printf/">format specifier</a> such as <code class="language-plaintext highlighter-rouge">%d</code> for integers. <ul> <li>Warning: <code class="language-plaintext highlighter-rouge">printf</code> is fairly heavy duty, so be cautious when calling it when measuring microarchitectural behaviours!</li> </ul> </li> </ul> <h2 id="pointers"> <a href="#pointers" class="anchor-heading" aria-labelledby="pointers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pointers </h2> <h3 id="declaration-address-of-dereference"> <a href="#declaration-address-of-dereference" class="anchor-heading" aria-labelledby="declaration-address-of-dereference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Declaration, Address-of, Dereference </h3> <p>An extremely powerful tool used in C programs to interact with memory are <em>pointers</em>. Pointers are variables that contain a <em>memory address</em>, rather than a value directly.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">example_method</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span> <span class="c1">// (1)</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>  <span class="c1">// (2)</span>
  <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">9876</span><span class="p">;</span>    <span class="c1">// (3)</span>
<span class="p">}</span>
</code></pre></div></div> <p>In this code, we declare an integer variable <code class="language-plaintext highlighter-rouge">a</code> and assign value 1234 to it. Next, we decleare a pointer variable, name it <code class="language-plaintext highlighter-rouge">b</code>, and assign the <em>address</em> of <code class="language-plaintext highlighter-rouge">a</code> to it, meaning we make pointer <code class="language-plaintext highlighter-rouge">b</code> points to the location of <code class="language-plaintext highlighter-rouge">a</code>.</p> <p>Let’s first understand three pointer-related operations.</p> <ul> <li><strong>Pointer declaration</strong>: To declare a pointer and give it a name, you need to use the type written as <code class="language-plaintext highlighter-rouge">int *</code>. More generally, it is written as the target data type followed by a star, such as <code class="language-plaintext highlighter-rouge">char *</code>, <code class="language-plaintext highlighter-rouge">void *</code>, etc. In the code above, we define a pointer named <code class="language-plaintext highlighter-rouge">b</code> and tell the compiler that it points to an integer.</li> <li><strong>Obtaining address</strong>: Every variable in C is stored in a location in memory, and thus each of them has an address. We use <code class="language-plaintext highlighter-rouge">&amp;</code> to obtain the address of a variable, and <code class="language-plaintext highlighter-rouge">&amp;</code> is called the <em>address-of operator</em>. As shown, we obtain the address of the variable <code class="language-plaintext highlighter-rouge">a</code> by writing <code class="language-plaintext highlighter-rouge">&amp;a</code>.</li> <li><strong>Dereference a pointer</strong>: Given a pointer, we can read or write the location pointed to by the pointer by <em>dereferencing</em> it. As shown, we write to the location pointed to by <code class="language-plaintext highlighter-rouge">b</code> by writing <code class="language-plaintext highlighter-rouge">*b = 9876</code>. Because <code class="language-plaintext highlighter-rouge">b</code> points to <code class="language-plaintext highlighter-rouge">a</code>, so after executing the last line of the code, if you read variable <code class="language-plaintext highlighter-rouge">a</code>, you will see it is now equal to 9876.</li> </ul> <blockquote class="warning"> <p><strong>Pointer declaration vs. Pointer dereference</strong></p> <p>Pointer declaration and pointer dereference both involve using the <code class="language-plaintext highlighter-rouge">*</code> notation. Make sure you understand what the <code class="language-plaintext highlighter-rouge">*</code> means each time you see it. For example, <code class="language-plaintext highlighter-rouge">int *b = &amp;a;</code> is the same as <code class="language-plaintext highlighter-rouge">int *b; b = &amp;a;</code>. Here, <code class="language-plaintext highlighter-rouge">*</code> means pointer declaration, and the assignement (i.e., <code class="language-plaintext highlighter-rouge">=</code>) initializes the pointer, NOT the value that the pointer points to.</p> </blockquote> <p>Next, let’s visualize the memory layout for the code above so you can get a better view. Reach to the course staff if you find the figure below difficult to understand.</p> <p><img src="figures/cpp.png" alt="C Example Memory Layout" style="display:block; margin-left:auto; margin-right:auto" width="65%" /></p> <h3 id="casting"> <a href="#casting" class="anchor-heading" aria-labelledby="casting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Casting </h3> <p>Occasionally you may be required to change the data type of a variable. For instance, you may want to access a specific address at a given 64-bit integer value. To do this, you can <em>cast</em> a variable into another as such:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">example_method</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint64_t</span> <span class="n">x</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>    <span class="c1">// x is a 64-bit unsigned integer</span>
    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// change the type of x to make it a pointer (treat it as an address)</span>
    <span class="kt">uint8_t</span> <span class="n">z</span> <span class="o">=</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>             <span class="c1">// access the data pointed to by pointer y.</span>
                                <span class="c1">// z now contains the data from address 0x12345678</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="a-pointer-points-to-another-pointer"> <a href="#a-pointer-points-to-another-pointer" class="anchor-heading" aria-labelledby="a-pointer-points-to-another-pointer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A Pointer Points to Another Pointer </h3> <p>We can define a pointer that points to a location that holds another pointer.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span> 
<span class="kt">int</span> <span class="o">**</span><span class="n">c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">;</span> 
</code></pre></div></div> <p>In the code above, <code class="language-plaintext highlighter-rouge">int **</code> should be interpreted as <code class="language-plaintext highlighter-rouge">(int *)*</code>, meaning a pointer that points to a location holds a <code class="language-plaintext highlighter-rouge">int *</code>, which is also a pointer. You can dereference the pointer <code class="language-plaintext highlighter-rouge">c</code> in two ways. In both cases, <code class="language-plaintext highlighter-rouge">val</code> will be 1234.</p> <ul> <li><code class="language-plaintext highlighter-rouge">int val = **c;</code></li> <li><code class="language-plaintext highlighter-rouge">int* ptr = *c; int val = *ptr;</code></li> </ul> <h2 id="commonly-used-data-structures"> <a href="#commonly-used-data-structures" class="anchor-heading" aria-labelledby="commonly-used-data-structures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commonly Used Data Structures </h2> <h3 id="arrays"> <a href="#arrays" class="anchor-heading" aria-labelledby="arrays"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Arrays </h3> <p>C arrays are much like arrays in other languages!</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">example_method</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// array declaration</span>

  <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// access array element like in other languages</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"The first element of a is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"The second element of a is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"The first element of a is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="c1">// treat the array identifier as a pointer</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"The second element of a is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>  
<span class="p">}</span>
</code></pre></div></div> <p>Observe that the array variable (i.e. <code class="language-plaintext highlighter-rouge">a</code>) is just a pointer to the first element in the array (remember that C arrays start at 0). Specifically, <code class="language-plaintext highlighter-rouge">ptr[index]</code> treats <code class="language-plaintext highlighter-rouge">ptr</code> as an array and retrieves the entry at index <code class="language-plaintext highlighter-rouge">index</code>. This is the same as <code class="language-plaintext highlighter-rouge">*(ptr+index)</code>.</p> <blockquote class="warning"> <p><strong>Pointer arithemetic operation under the hood</strong></p> <p>In <code class="language-plaintext highlighter-rouge">a[1]</code> and <code class="language-plaintext highlighter-rouge">*(a + 1)</code>, the value <code class="language-plaintext highlighter-rouge">1</code> does not mean 1 <strong>byte</strong>. Instead it means 1 <strong>element</strong>.</p> <p>For example, if <code class="language-plaintext highlighter-rouge">ptr</code> points to address <code class="language-plaintext highlighter-rouge">0xFF00</code>, then which address does <code class="language-plaintext highlighter-rouge">ptr+1</code> point to? The answer is not <code class="language-plaintext highlighter-rouge">0xFF01</code>. Instead it should be <code class="language-plaintext highlighter-rouge">0xFF00 + sizeof(int) = 0xFF04</code>, as the size of an <code class="language-plaintext highlighter-rouge">int</code> is 4 bytes. Under the hood, the compiler is doing the pointer arithemetic computation for us by converting the 1 to 4 bytes based on the pointer type.</p> </blockquote> <blockquote class="hint"> <p>Cheatsheet for Pointer size and Data Size</p> <ul> <li><code class="language-plaintext highlighter-rouge">int</code>: 4 bytes</li> <li><code class="language-plaintext highlighter-rouge">char</code>: 1 byte</li> <li><code class="language-plaintext highlighter-rouge">uint64_t</code> means 64-bit unsigned integer: 8 bytes.</li> <li>a pointer (<code class="language-plaintext highlighter-rouge">int *</code>, <code class="language-plaintext highlighter-rouge">char *</code>, <code class="language-plaintext highlighter-rouge">void *</code>): depends on your machine. On a 64-bit machine, no matter what data type it points to, a pointer is 64 bits, i.e., 8 bytes.</li> </ul> <p>If you incur a new data type and want to find out its size, you can <code class="language-plaintext highlighter-rouge">printf("the size is: %lu\n", sizeof(x))</code> where <code class="language-plaintext highlighter-rouge">x</code> is the variable with the data type that you want to query about. Note that, when you cast a pointer, the address this pointer points to does not change, but the size may change, and the meaning of the associated arithemetic operation will also change.</p> </blockquote> <h3 id="strings"> <a href="#strings" class="anchor-heading" aria-labelledby="strings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strings </h3> <p>In memory, a string of “Hi!” looks like this</p> <div class="table-wrapper"><table> <tbody> <tr> <td>Address</td> <td>0x0</td> <td>0x1</td> <td>0x2</td> <td>0x3</td> <td>0x4</td> <td>0x5</td> </tr> <tr> <td>Data</td> <td>‘H’</td> <td>‘i’</td> <td>’!’</td> <td>‘\0’</td> <td>-</td> <td>-</td> </tr> </tbody> </table></div> <p>In C, strings are just character arrays in disguise!</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">example_method</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">string</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Hi!"</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"String stored: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>

  <span class="c1">// Print it character-by-character</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Character %d of string: %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Since a string is encoded as a fixed length array (e.g. 6 characters in our case), we need a way to indicate the <em>end</em> of the text. We use the <em>null terminator</em> (e.g. <code class="language-plaintext highlighter-rouge">0x00</code>) to denote the end of the string (this is automatically inserted for you when you write “Hi!”).</p> <blockquote class="warning"> <p>The above character-by-character code is actually quite dangerous! Think about what happens if you accidentally forget the null terminator here.</p> </blockquote> <h2 id="useful-for-the-cache-lab"> <a href="#useful-for-the-cache-lab" class="anchor-heading" aria-labelledby="useful-for-the-cache-lab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Useful for the Cache Lab </h2> <h3 id="dynamically-allocated-memory"> <a href="#dynamically-allocated-memory" class="anchor-heading" aria-labelledby="dynamically-allocated-memory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dynamically Allocated Memory </h3> <p>You may have noticed that we were statically sizing our data structures in the previous sections. Sometimes you may want to allocate a dynamic amount of memory at runtime. This can be done using <code class="language-plaintext highlighter-rouge">malloc()</code> and <code class="language-plaintext highlighter-rouge">free()</code>:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">example_method</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span> <span class="c1">// request a region that can hold 2 `int`</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">array</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"malloc failed! </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="n">free</span><span class="p">(</span><span class="n">array</span><span class="p">);</span> <span class="c1">// return the memory region so others can resue it</span>
<span class="p">}</span>
</code></pre></div></div> <p>On success, <code class="language-plaintext highlighter-rouge">malloc</code> returns a pointer to the beginning of some newly allocated memory. To avoid a memory leak, make sure to deallocate dynamically allocated memory regions after you’re done with them using <code class="language-plaintext highlighter-rouge">free()</code>.</p> <!-- ### Bitwise operations You can use bitwise operators (e.g.,` &`,` |`, `>>`, `<<`) in C just like in python. They can help you calculate addresses. For example, the following function extract the page number (4K page) from an address: ```c uint64_t get_page_number(uint64_t addr) { return addr >> 12; } ``` Make sure you are using unsigned types (e.g., `uint64_t`) instead of signed types (e.g., `int64_t`) for the address calculation. Otherwise, you might see unexpected result for the `>>` operation. --> <!-- However, be aware that `>>` has different behaviors for unsigned types (e.g., `uint64_t`) and signed types (e.g., `int64_t`). For our cache lab, using unsigned types probably will give you the expected behavior. For example: ```c uint32_t addr = 0xFFFFFFF0; printf("0x%x\n", (addr >> 12)); // print: 0x000FFFFF printf("0x%x\n", (uint32_t)(((int32_t)addr) >> 12)); // print: 0xFFFFFFFF ``` --> <h2 id="useful-for-rowhammer-lab"> <a href="#useful-for-rowhammer-lab" class="anchor-heading" aria-labelledby="useful-for-rowhammer-lab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Useful for Rowhammer Lab </h2> <p>For later labs in the course, some advanced knowledge of C/C++ constructs may be required. We list some notes below for your reference.</p> <h3 id="c-maps-stdmap"> <a href="#c-maps-stdmap" class="anchor-heading" aria-labelledby="c-maps-stdmap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> C++ Maps (<code class="language-plaintext highlighter-rouge">std::map</code>) </h3> <p>C++ is a slight departure from C – it is a higher-level multi-paradigm programming language which shares a majority of its syntax with C, and is quite interoperable with C (apart from some minor exceptions).</p> <p>C++ maps are very similar to Python dictionaries, with key-value pairs being assigned in a very similar fashion. A full description of this data structure can be found <a href="https://en.cppreference.com/w/cpp/container/map">here</a>.</p> <p>An example of using C++ maps is shown below.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="p">,</span> <span class="kt">uint64_t</span><span class="o">&gt;</span> <span class="n">cpp_map</span><span class="p">;</span>
<span class="kt">uint64_t</span> <span class="n">key</span> <span class="o">=</span> <span class="mh">0xDEAD</span><span class="p">;</span>
<span class="kt">uint64_t</span> <span class="n">value</span> <span class="o">=</span> <span class="mh">0xBEEF</span><span class="p">;</span>

<span class="c1">// Add or modify a key-value pair</span>
<span class="n">cpp_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>

<span class="c1">// Retrieve a value for a key</span>
<span class="kt">uint64_t</span> <span class="n">key2</span> <span class="o">=</span> <span class="mh">0xBAAD</span><span class="p">;</span>
<span class="kt">uint64_t</span> <span class="n">value2</span> <span class="o">=</span> <span class="n">cpp_map</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
<span class="k">if</span> <span class="p">(</span><span class="n">value2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">assert</span><span class="p">(</span><span class="s">"Key does not exist!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="capture-the-flag-ctf"> <a href="#capture-the-flag-ctf" class="anchor-heading" aria-labelledby="capture-the-flag-ctf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capture the Flag (CTF) </h2> <p>With knowledge of these constructs, let’s try some CTF challenges! Check Piazza Post to get started.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
